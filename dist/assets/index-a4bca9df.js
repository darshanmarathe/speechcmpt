var Ut=Object.defineProperty;var Nt=(P,p,m)=>p in P?Ut(P,p,{enumerable:!0,configurable:!0,writable:!0,value:m}):P[p]=m;var q=(P,p,m)=>(Nt(P,typeof p!="symbol"?p+"":p,m),m);import{Tag as dt,Component as mt,html as O}from"https://cdn.jsdelivr.net/npm/componentforge";import ft from"https://unpkg.com/siriwave/dist/siriwave.esm.min.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))v(c);new MutationObserver(c=>{for(const g of c)if(g.type==="childList")for(const S of g.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&v(S)}).observe(document,{childList:!0,subtree:!0});function m(c){const g={};return c.integrity&&(g.integrity=c.integrity),c.referrerPolicy&&(g.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?g.credentials="include":c.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function v(c){if(c.ep)return;c.ep=!0;const g=m(c);fetch(c.href,g)}})();var N=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},tt={exports:{}};(function(P,p){try{Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(f,u){return new Uint8Array(Array.prototype.slice.call(this,f,u))}})}catch{}var m=typeof Object.create=="function"?Object.create:function(f){function u(){}return u.prototype=f,new u},v;if(typeof Object.setPrototypeOf=="function")v=Object.setPrototypeOf;else{var c;t:{var g={D:!0},S={};try{S.__proto__=g,c=S.D;break t}catch{}c=!1}v=c?function(f,u){if(f.__proto__=u,f.__proto__!==u)throw new TypeError(f+" is not extensible");return f}:null}var T=v;function k(f,u){if(f.prototype=m(u.prototype),f.prototype.constructor=f,T)T(f,u);else for(var l in u)if(l!="prototype")if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(u,l);d&&Object.defineProperty(f,l,d)}else f[l]=u[l]}var b=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,u,l){f!=Array.prototype&&f!=Object.prototype&&(f[u]=l.value)},gt=(typeof window<"u"&&window===N||typeof N<"u"&&N!=null,N);function G(f,u){if(u){for(var l=gt,d=f.split("."),z=0;z<d.length-1;z++){var M=d[z];M in l||(l[M]={}),l=l[M]}d=d[d.length-1],z=l[d],M=u(z),M!=z&&M!=null&&b(l,d,{configurable:!0,writable:!0,value:M})}}G("Object.is",function(f){return f||function(u,l){return u===l?u!==0||1/u===1/l:u!==u&&l!==l}}),G("Array.prototype.includes",function(f){return f||function(u,l){var d=this;d instanceof String&&(d=String(d));var z=d.length,M=l||0;for(0>M&&(M=Math.max(M+z,0));M<z;M++){var C=d[M];if(C===u||Object.is(C,u))return!0}return!1}}),G("String.prototype.codePointAt",function(f){return f||function(u){if(this==null)throw new TypeError("The 'this' value for String.prototype.codePointAt must not be null or undefined");var l=this.length;if(u=Number(u)||0,0<=u&&u<l){u|=0;var d=this.charCodeAt(u);return 55296>d||56319<d||u+1===l?d:(u=this.charCodeAt(u+1),56320>u||57343<u?d:1024*(d-55296)+u+9216)}}});var wt=typeof Object.assign=="function"?Object.assign:function(f,u){for(var l=1;l<arguments.length;l++){var d=arguments[l];if(d)for(var z in d)Object.prototype.hasOwnProperty.call(d,z)&&(f[z]=d[z])}return f};G("Object.assign",function(f){return f||wt});function yt(f){function u(t){var i=l.call(this)||this;return t&&i.fromBuffer(t),i}function l(){return C.apply(this,arguments)||this}function d(t,i,e){for(var s=[],n=0;n<t;n++)s.push(this.b({pa:i,oa:e,Q:.5/Math.sin(Math.PI/(2*t)*(n+.5))}));for(this.a=[],t=0;t<s.length;t++)this.a[t]={Ka:s[t].A[0],La:s[t].A[1],Ma:s[t].A[2],Ha:s[t].D[0],Ia:s[t].D[1],k:s[t].k,z:[0,0]}}function z(t,i,e){e=2*Math.PI*e/i,i=0,this.a=[];for(var s=0;s<=t;s++)s-t/2===0?this.a[s]=e:(this.a[s]=Math.sin(e*(s-t/2))/(s-t/2),this.a[s]*=.54-.46*Math.cos(2*Math.PI*s/t)),i+=this.a[s];for(e=0;e<=t;e++)this.a[e]/=i;this.z=this.b()}function M(t,i,e){this.C=t,this.l=(t-1)/i,this.M=this.I,e.method==="point"?this.M=this.H:e.method==="linear"?this.M=this.G:e.method==="cubic"&&(this.M=this.B),this.J=1-Math.max(0,Math.min(1,e.tension||0)),this.v=e.sincFilterSize||1,this.F=Rt(e.sincWindow||At)}function C(){return F.apply(this,arguments)||this}function F(){return I.apply(this,arguments)||this}function I(){var t=w.call(this)||this;return t.bitDepth="0",t.f={h:0,o:!1},t.G={4:17,8:1,"8a":6,"8m":7,16:1,24:1,32:1,"32f":3,64:3},t}function w(){return L.apply(this,arguments)||this}function L(){var t=R.call(this)||this;return t.Z.push("RF64"),t.fmt={chunkId:"",chunkSize:0,audioFormat:0,numChannels:0,sampleRate:0,byteRate:0,blockAlign:0,bitsPerSample:0,cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]},t.fact={chunkId:"",chunkSize:0,dwSampleLength:0},t.cue={chunkId:"",chunkSize:0,dwCuePoints:0,points:[]},t.smpl={chunkId:"",chunkSize:0,dwManufacturer:0,dwProduct:0,dwSamplePeriod:0,dwMIDIUnityNote:0,dwMIDIPitchFraction:0,dwSMPTEFormat:0,dwSMPTEOffset:0,dwNumSampleLoops:0,dwSamplerData:0,loops:[]},t.bext={chunkId:"",chunkSize:0,description:"",originator:"",originatorReference:"",originationDate:"",originationTime:"",timeReference:[0,0],version:0,UMID:"",loudnessValue:0,loudnessRange:0,maxTruePeakLevel:0,maxMomentaryLoudness:0,maxShortTermLoudness:0,reserved:"",codingHistory:""},t.iXML={chunkId:"",chunkSize:0,value:""},t.ds64={chunkId:"",chunkSize:0,riffSizeHigh:0,riffSizeLow:0,dataSizeHigh:0,dataSizeLow:0,originationTime:0,sampleCountHigh:0,sampleCountLow:0},t.data={chunkId:"",chunkSize:0,samples:new Uint8Array(0)},t.LIST=[],t.junk={chunkId:"",chunkSize:0,chunkData:[]},t._PMX={chunkId:"",chunkSize:0,value:""},t.g={h:16,o:!1,O:!1,R:!1},t}function R(){this.container="",this.chunkSize=0,this.format="",this.Y=null,this.c=0,this.a={h:32,o:!1},this.Z=["RIFF","RIFX"]}function _(t,i){this.offset=Math.ceil((t+i)/8),this.b=t,this.c=i,this.a=(1<<t-1)-1,this.f=Math.pow(2,this.a+1),this.g=t+i,this.j=Math.pow(2,-(8*this.offset-1-t))}function X(t,i){this.h=t,this.offset=Math.ceil(t/8),this.max=Math.pow(2,t)-1,this.min=0,this.S=this.a,i!==void 0&&i&&(this.max=Math.pow(2,t)/2-1,this.min=-this.max-1,this.S=this.f)}function St(t){for(var i=new Uint8Array(256),e=0;64>e;e++)i["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;e=.75*t.length,t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--),e=new Uint8Array(e);for(var s=0,n=0;s<t.length;s+=4){var h=i[t.charCodeAt(s)],r=i[t.charCodeAt(s+1)],a=i[t.charCodeAt(s+2)],y=i[t.charCodeAt(s+3)];e[n++]=h<<2|r>>4,e[n++]=(r&15)<<4|a>>2,e[n++]=(a&3)<<6|y&63}return e}function kt(t,i){return t=0<t?parseInt(t/i.ea*i.ca,10):parseInt(t/i.fa*i.da,10)}function It(t,i){return parseInt(0<t?t*i.ca:t*i.da,10)}function Lt(t,i){return 0<t?t/i.ea:t/i.fa}function Mt(t,i){function e(s){return s}return t!=i&&(e=["32f","64"].includes(t)?It:["32f","64"].includes(i)?Lt:kt),e}function it(t){if(t!="32f"&&t!="64"&&("8">parseInt(t,10)||"53"<parseInt(t,10)))throw Error("Invalid bit depth.")}function et(t,i,e){if(t=="8"){t=e?-128:128,e=0;for(var s=i.length;e<s;e++)i[e]=i[e]+=t}}function Pt(t){for(var i={index:0,i:0,step:7},e=new Uint8Array(t.length),s=[],n=0,h=0,r=0,a=t.length;r<a;r++)r%505==0&&r!=0&&(e.set(xt(s,i),n),n+=256,s=[],h++),s.push(t[r]);return t=t.length/2,t%2&&t++,e.slice(0,t+512+4*h)}function Ct(t,i){i=i===void 0?256:i;for(var e={index:0,i:0,step:7},s=new Int16Array(2*t.length),n=[],h=0,r=0,a=t.length;r<a;r++){if(r%i==0&&r!=0){var y=e,D=n[1]<<8|n[0];y.i=32768<D?D-65536:D,y.index=n[2],y.step=Z[y.index],D=[y.i,y.i];for(var W=4,Xt=n.length;W<Xt;W++){var pt=n[W],ct=pt>>4;D.push(st(ct<<4^pt,y)),D.push(st(ct,y))}n=D,s.set(n,h),h+=n.length,n=[]}n.push(t[r])}return s}function xt(t,i){var e=t[0];K(e,i);var s=[];s.push(e&255),s.push(e>>8&255),s.push(i.index),s.push(0),e=3;for(var n=t.length;e<n;e+=2){var h=K(t[e],i),r=K(t[e+1],i);s.push(r<<4|h)}return s}function K(t,i){var e=t-i.i;if(0<=e)var s=0;else s=8,e=-e;var n=Z[i.index],h=n>>3;return e>n&&(s|=4,e-=n,h+=n),n>>=1,e>n&&(s|=2,e-=n,h+=n),n>>=1,e>n&&(s|=1,h+=n),e=s,i.i=e&8?i.i-h:i.i+h,-32768>i.i?i.i=-32768:32767<i.i&&(i.i=32767),i.index+=ut[e&7],0>i.index?i.index=0:88<i.index&&(i.index=88),s}function st(t,i){var e=0;return t&4&&(e+=i.step),t&2&&(e+=i.step>>1),t&1&&(e+=i.step>>2),e+=i.step>>3,t&8&&(e=-e),i.i+=e,32767<i.i?i.i=32767:-32767>i.i&&(i.i=-32767),i.index+=ut[t],0>i.index?i.index=0:88<i.index&&(i.index=88),i.step=Z[i.index],i.i}function zt(t){for(var i=new Uint8Array(t.length),e=0,s=t.length;e<s;e++){var n=e,h=t[e];h=h==-32768?-32767:h;var r=~h>>8&128;if(r||(h*=-1),32635<h&&(h=32635),256<=h){var a=Ot[h>>8&127];h=a<<4|h>>a+3&15}else h>>=4;i[n]=h^r^85}return i}function bt(t){for(var i=new Int16Array(t.length),e=0,s=t.length;e<s;e++){var n=e,h=t[e],r=0;h^=85,h&128&&(h&=-129,r=-1);var a=((h&240)>>4)+4;h=a!=4?1<<a|(h&15)<<a-4|1<<a-5:h<<1|1,i[n]=-8*(r===0?h:-h)}return i}function Dt(t){for(var i=new Uint8Array(t.length),e=0,s=t.length;e<s;e++){var n=e,h=t[e],r=h>>8&128;r!=0&&(h=-h),h+=132,32635<h&&(h=32635);var a=Ft[h>>7&255];i[n]=~(r|a<<4|h>>a+3&15)}return i}function Tt(t){for(var i=new Int16Array(t.length),e=0,s=t.length;e<s;e++){var n=e,h=t[e];h=~h;var r=h>>4&7;r=Et[r]+((h&15)<<r+3),h&128&&(r=-r),i[n]=r}return i}function nt(t,i,e,s){for(s=s===void 0?t.length:s,e=e===void 0?0:e;e<s;e+=i){var n=t,h=i,r=e;h--;for(var a=0;a<h;a++){var y=n[r+a];n[r+a]=n[r+h],n[r+h]=y,h--}}}function Q(t,i,e){e=e===void 0?0:e;for(var s=0,n=t.length;s<n;){var h=t.codePointAt(s);if(128>h)i[e]=h,e++;else{var r=0,a=0;for(2047>=h?(r=1,a=192):65535>=h?(r=2,a=224):1114111>=h&&(r=3,a=240,s++),i[e]=(h>>6*r)+a,e++;0<r;)i[e]=128|h>>6*(r-1)&63,e++,r--}s++}return e}function Y(t){var i=Math.floor(t);return t-=i,.5>t?i:.5<t||i%2?i+1:i}function U(t,i,e){e=e===void 0?t.length:e;var s=i===void 0?0:i;for(e=e===void 0?t.length:e,i="",s=s===void 0?0:s;s<e;){var n=128,h=191,r=!1,a=t[s++];if(0<=a&&127>=a)i+=String.fromCharCode(a);else{var y=0;194<=a&&223>=a?y=1:224<=a&&239>=a?(y=2,t[s]===224&&(n=160),t[s]===237&&(h=159)):240<=a&&244>=a?(y=3,t[s]===240&&(n=144),t[s]===244&&(h=143)):r=!0,a&=(1<<8-y-1)-1;for(var D=0;D<y;D++)(t[s]<n||t[s]>h)&&(r=!0),a=a<<6|t[s]&63,s++;r?i+=String.fromCharCode(65533):65535>=a?i+=String.fromCharCode(a):(a-=65536,i+=String.fromCharCode((a>>10&1023)+55296,(a&1023)+56320))}}return i}function x(t){var i=[];return Q(t,i),i}function V(t,i,e,s){s=s===void 0?0:s,i=i||{};for(var n=rt(i.h,i.R,i.O),h=Math.ceil(i.h/8),r=0,a=s,y=t.length;r<y;r++)s=n.ga(e,t[r],s);return i.o&&nt(e,h,a,s),s}function B(t,i,e,s,n){s=s===void 0?0:s,n=n===void 0?t.length:n,i=i||{};var h=rt(i.h,i.R,i.O);n-=(n-s)%h.offset,i.o&&(t=new Uint8Array(t),i.o&&nt(t,h.offset,s,n)),ht(t,e,s,n,h)}function o(t,i){var e=[];return V([t],i,e,0),e}function J(t,i,e){e=e===void 0?0:e;var s=[];return B(t,i,s,e,e+Math.ceil(i.h/8)),s[0]}function ht(t,i,e,s,n){for(var h=n.offset,r=0;e<s;e+=h,r++)i[r]=n.S(t,e)}function rt(t,i,e){return i&&t==32?new _(8,23):i&&t==64?new _(11,52):new X(t,e)}function A(t,i){for(var e=x(t),s=e.length;s<i;s++)e.push(0);return e}function At(t){return Math.exp(-t/2*t/2)}function Rt(t){return function(i){return(i===0?1:Math.sin(Math.PI*i)/(Math.PI*i))*t(i)}}function ot(t,i,e,s){s=(s===void 0?null:s)||{};var n=new Float64Array(t.length*((e-i)/i+1));s.method=s.method||"cubic";var h=new M(t.length,n.length,{method:s.method,tension:s.tension||0,sincFilterSize:s.sincFilterSize||6,sincWindow:s.sincWindow||void 0,clip:s.clip||"mirror"});if(s.LPF===void 0&&(s.LPF=jt[s.method]),s.LPF){s.LPFType=s.LPFType||"IIR";var r=Bt[s.LPFType];if(e>i){for(i=new r(s.LPForder||lt[s.LPFType],e,i/2),e=0,s=n.length;e<s;e++)n[e]=i.filter(h.M(e,t));for(i.reset(),t=n.length-1;0<=t;t--)n[t]=i.filter(n[t])}else{for(i=new r(s.LPForder||lt[s.LPFType],i,e/2),e=0,s=t.length;e<s;e++)t[e]=i.filter(t[e]);for(i.reset(),e=t.length-1;0<=e;e--)t[e]=i.filter(t[e]);at(t,n,h)}}else at(t,n,h);return n}function at(t,i,e){for(var s=0,n=i.length;s<n;s++)i[s]=e.M(s,t)}function H(t,i){var e=t/i;return e%2&&e++,e}var ut=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],Z=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767],Ot=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],Ft=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],Et=[0,132,396,924,1980,4092,8316,16764];X.prototype.ga=function(t,i,e){e=e===void 0?0:e,i=this.b(Math.round(i));for(var s=0,n=this.offset;s<n;s++)t[e]=Math.floor(i/Math.pow(2,8*s))&255,e++;return e},X.prototype.a=function(t,i){i=i===void 0?0:i;for(var e=0,s=0;s<this.offset;s++)e+=t[i+s]*Math.pow(256,s);return e},X.prototype.f=function(t,i){return this.c(this.a(t,i===void 0?0:i))},X.prototype.b=function(t){return t>this.max?this.max:t<this.min?this.min:t},X.prototype.c=function(t){return t>this.max&&(t-=2*this.max+2),t},_.prototype.ga=function(t,i,e){Math.abs(i)>this.f-2*this.g&&(i=0>i?-1/0:1/0);var s=0>((i=+i)||1/i)||0>i?1:0;i=Math.abs(i);var n=Math.min(Math.floor(Math.log(i)/Math.LN2),1023),h=Y(i/Math.pow(2,n)*Math.pow(2,this.c));return i!==i?(h=Math.pow(2,this.c-1),n=(1<<this.b)-1):i!==0&&(i>=Math.pow(2,1-this.a)?(2<=h/Math.pow(2,this.c)&&(n+=1,h=1),n>this.a?(n=(1<<this.b)-1,h=0):(n+=this.a,h=Y(h)-Math.pow(2,this.c))):(h=Y(i/Math.pow(2,1-this.a-this.c)),n=0)),this.l(t,e,s,n,h)},_.prototype.S=function(t,i){for(var e=(1<<this.b)-1,s="",n=this.offset-1;0<=n;n--){var h=t[n+i].toString(2);s+="00000000".substring(h.length)+h}return n=s.charAt(0)=="1"?-1:1,s=s.substring(1),h=parseInt(s.substring(0,this.b),2),s=s.substring(this.b),h==e?parseInt(s,2)!==0?NaN:1/0*n:(h===0?(h+=1,e=parseInt(s,2)):e=parseInt("1"+s,2),n*e*this.j*Math.pow(2,h-this.a))},_.prototype.l=function(t,i,e,s,n){var h=[];for(h.push(e),e=this.b;0<e;--e)h[e]=s%2?1:0,s=Math.floor(s/2);for(s=h.length,e=this.c;0<e;--e)h[s+e]=n%2?1:0,n=Math.floor(n/2);for(n=h.join(""),h=this.offset+i-1,s=i;h>=i;)t[h]=parseInt(n.substring(0,8),2),n=n.substring(8),h--,s++;return s},R.prototype.va=function(t){if(this.c=0,this.container=this.u(t,4),this.Z.indexOf(this.container)===-1)throw Error("Not a supported format.");this.a.o=this.container==="RIFX",this.chunkSize=this.b(t),this.format=this.u(t,4),this.Y={chunkId:this.container,chunkSize:this.chunkSize,format:this.format,subChunks:this.V(t)}},R.prototype.s=function(t,i){i=i===void 0?!1:i;for(var e=this.Y.subChunks,s=[],n=0;n<e.length;n++)if(e[n].chunkId==t)if(i)s.push(e[n]);else return e[n];return t=="LIST"&&s.length?s:null},R.prototype.u=function(t,i){var e=U(t,this.c,this.c+i);return this.c+=i,e},R.prototype.b=function(t){return t=J(t,this.a,this.c),this.c+=4,t},R.prototype.V=function(t){for(var i=[],e=this.c;e<=t.length-8;)i.push(this.$a(t,e)),e+=8+i[i.length-1].chunkSize,e=e%2?e+1:e;return i},R.prototype.$a=function(t,i){var e={chunkId:this.Ea(t,i),chunkSize:this.Fa(t,i)};return e.chunkId=="LIST"?(e.format=U(t,i+8,i+12),this.c+=4,e.subChunks=this.V(t)):(this.c=i+8+(e.chunkSize%2?e.chunkSize+1:e.chunkSize),e.chunkData={start:i+8,end:this.c}),e},R.prototype.Ea=function(t,i){return this.c+=4,U(t,i,i+4)},R.prototype.Fa=function(t,i){return this.c+=4,J(t,this.a,i+4)},k(L,R),L.prototype.fromBuffer=function(t,i){if(i=i===void 0?!0:i,this.U(),this.va(t),this.g.o=this.a.o,this.format!="WAVE")throw Error('Could not find the "WAVE" format identifier');this.hb(t),this.jb(t),this.ib(t),this.eb(t),this.qa(t),this.fb(t),this.ma(t),this.gb(t,i),this.lb(t),this.ia(t),this.na(t)},L.prototype.U=function(){var t=new L;Object.assign(this.fmt,t.fmt),Object.assign(this.fact,t.fact),Object.assign(this.cue,t.cue),Object.assign(this.smpl,t.smpl),Object.assign(this.bext,t.bext),Object.assign(this.iXML,t.iXML),Object.assign(this.ds64,t.ds64),Object.assign(this.data,t.data),this.LIST=[],Object.assign(this.junk,t.junk),Object.assign(this._PMX,t._PMX)},L.prototype.jb=function(t){var i=this.s("fmt ");if(i)this.c=i.chunkData.start,this.fmt.chunkId=i.chunkId,this.fmt.chunkSize=i.chunkSize,this.fmt.audioFormat=this.j(t),this.fmt.numChannels=this.j(t),this.fmt.sampleRate=this.b(t),this.fmt.byteRate=this.b(t),this.fmt.blockAlign=this.j(t),this.fmt.bitsPerSample=this.j(t),this.kb(t);else throw Error('Could not find the "fmt " chunk')},L.prototype.kb=function(t){16<this.fmt.chunkSize&&(this.fmt.cbSize=this.j(t),18<this.fmt.chunkSize&&(this.fmt.validBitsPerSample=this.j(t),20<this.fmt.chunkSize&&(this.fmt.dwChannelMask=this.b(t),this.fmt.subformat=[this.b(t),this.b(t),this.b(t),this.b(t)])))},L.prototype.ib=function(t){var i=this.s("fact");i&&(this.c=i.chunkData.start,this.fact.chunkId=i.chunkId,this.fact.chunkSize=i.chunkSize,this.fact.dwSampleLength=this.b(t))},L.prototype.fb=function(t){var i=this.s("cue ");if(i)for(this.c=i.chunkData.start,this.cue.chunkId=i.chunkId,this.cue.chunkSize=i.chunkSize,this.cue.dwCuePoints=this.b(t),i=0;i<this.cue.dwCuePoints;i++)this.cue.points.push({dwName:this.b(t),dwPosition:this.b(t),fccChunk:this.u(t,4),dwChunkStart:this.b(t),dwBlockStart:this.b(t),dwSampleOffset:this.b(t)})},L.prototype.ma=function(t){var i=this.s("smpl");if(i)for(this.c=i.chunkData.start,this.smpl.chunkId=i.chunkId,this.smpl.chunkSize=i.chunkSize,this.smpl.dwManufacturer=this.b(t),this.smpl.dwProduct=this.b(t),this.smpl.dwSamplePeriod=this.b(t),this.smpl.dwMIDIUnityNote=this.b(t),this.smpl.dwMIDIPitchFraction=this.b(t),this.smpl.dwSMPTEFormat=this.b(t),this.smpl.dwSMPTEOffset=this.b(t),this.smpl.dwNumSampleLoops=this.b(t),this.smpl.dwSamplerData=this.b(t),i=0;i<this.smpl.dwNumSampleLoops;i++)this.smpl.loops.push({dwName:this.b(t),dwType:this.b(t),dwStart:this.b(t),dwEnd:this.b(t),dwFraction:this.b(t),dwPlayCount:this.b(t)})},L.prototype.gb=function(t,i){var e=this.s("data");if(e)this.data.chunkId="data",this.data.chunkSize=e.chunkSize,i&&(this.data.samples=t.slice(e.chunkData.start,e.chunkData.end));else throw Error('Could not find the "data" chunk')},L.prototype.eb=function(t){var i=this.s("bext");i&&(this.c=i.chunkData.start,this.bext.chunkId=i.chunkId,this.bext.chunkSize=i.chunkSize,this.bext.description=this.u(t,256),this.bext.originator=this.u(t,32),this.bext.originatorReference=this.u(t,32),this.bext.originationDate=this.u(t,10),this.bext.originationTime=this.u(t,8),this.bext.timeReference=[this.b(t),this.b(t)],this.bext.version=this.j(t),this.bext.UMID=this.u(t,64),this.bext.loudnessValue=this.j(t),this.bext.loudnessRange=this.j(t),this.bext.maxTruePeakLevel=this.j(t),this.bext.maxMomentaryLoudness=this.j(t),this.bext.maxShortTermLoudness=this.j(t),this.bext.reserved=this.u(t,180),this.bext.codingHistory=this.u(t,this.bext.chunkSize-602))},L.prototype.qa=function(t){var i=this.s("iXML");i&&(this.c=i.chunkData.start,this.iXML.chunkId=i.chunkId,this.iXML.chunkSize=i.chunkSize,this.iXML.value=U(t,this.c,this.c+this.iXML.chunkSize))},L.prototype.hb=function(t){var i=this.s("ds64");if(i)this.c=i.chunkData.start,this.ds64.chunkId=i.chunkId,this.ds64.chunkSize=i.chunkSize,this.ds64.riffSizeHigh=this.b(t),this.ds64.riffSizeLow=this.b(t),this.ds64.dataSizeHigh=this.b(t),this.ds64.dataSizeLow=this.b(t),this.ds64.originationTime=this.b(t),this.ds64.sampleCountHigh=this.b(t),this.ds64.sampleCountLow=this.b(t);else if(this.container=="RF64")throw Error('Could not find the "ds64" chunk')},L.prototype.ia=function(t){var i=this.s("LIST",!0);if(i!==null)for(var e=0;e<i.length;e++){var s=i[e];this.LIST.push({chunkId:s.chunkId,chunkSize:s.chunkSize,format:s.format,subChunks:[]});for(var n=0;n<s.subChunks.length;n++)this.ka(s.subChunks[n],s.format,t)}},L.prototype.ka=function(t,i,e){i=="adtl"?-1<["labl","note","ltxt"].indexOf(t.chunkId)&&this.la(e,t):i=="INFO"&&this.ja(e,t)},L.prototype.la=function(t,i){this.c=i.chunkData.start;var e={chunkId:i.chunkId,chunkSize:i.chunkSize,dwName:this.b(t)};i.chunkId=="ltxt"?(e.dwSampleLength=this.b(t),e.dwPurposeID=this.b(t),e.dwCountry=this.j(t),e.dwLanguage=this.j(t),e.dwDialect=this.j(t),e.dwCodePage=this.j(t),e.value=""):e.value=this.X(t,this.c),this.LIST[this.LIST.length-1].subChunks.push(e)},L.prototype.ja=function(t,i){this.c=i.chunkData.start,this.LIST[this.LIST.length-1].subChunks.push({chunkId:i.chunkId,chunkSize:i.chunkSize,value:this.X(t,this.c)})},L.prototype.lb=function(t){var i=this.s("junk");i&&(this.junk={chunkId:i.chunkId,chunkSize:i.chunkSize,chunkData:[].slice.call(t.slice(i.chunkData.start,i.chunkData.end))})},L.prototype.na=function(t){var i=this.s("_PMX");i&&(this.c=i.chunkData.start,this._PMX.chunkId=i.chunkId,this._PMX.chunkSize=i.chunkSize,this._PMX.value=U(t,this.c,this.c+this._PMX.chunkSize))},L.prototype.X=function(t,i){for(var e=i=i===void 0?0:i;e<t.length&&(this.c++,t[e]!==0);e++);return U(t,i,this.c-1)},L.prototype.j=function(t){return t=J(t,this.g,this.c),this.c+=2,t},k(w,L),w.prototype.toBuffer=function(){this.g.o=this.container==="RIFX",this.a.o=this.g.o;for(var t=[this.Sa(),this.Oa(),this.Da(),this.bb(),this.Qa(),this.Pa(),x(this.data.chunkId),o(this.data.samples.length,this.a),this.data.samples,this.Ga(),this.Ya(),this.Ta(),this.ab()],i=0,e=0;e<t.length;e++)i+=t[e].length;e=new Uint8Array(i+12);var s=Q(this.container,e,0);for(s=V([i+4],this.a,e,s===void 0?0:s),s=Q(this.format,e,s===void 0?0:s),i=0;i<t.length;i++)e.set(t[i],s),s+=t[i].length;return e},w.prototype.Da=function(){var t=[];return this.Ca(),this.bext.chunkId&&(this.bext.chunkSize=602+this.bext.codingHistory.length,t=t.concat(x(this.bext.chunkId),o(602+this.bext.codingHistory.length,this.a),A(this.bext.description,256),A(this.bext.originator,32),A(this.bext.originatorReference,32),A(this.bext.originationDate,10),A(this.bext.originationTime,8),o(this.bext.timeReference[0],this.a),o(this.bext.timeReference[1],this.a),o(this.bext.version,this.g),A(this.bext.UMID,64),o(this.bext.loudnessValue,this.g),o(this.bext.loudnessRange,this.g),o(this.bext.maxTruePeakLevel,this.g),o(this.bext.maxMomentaryLoudness,this.g),o(this.bext.maxShortTermLoudness,this.g),A(this.bext.reserved,180),A(this.bext.codingHistory,this.bext.codingHistory.length))),this.l(t),t},w.prototype.Ca=function(){for(var t in this.bext)if(this.bext.hasOwnProperty(t)&&this.bext[t]&&t!="timeReference"){this.bext.chunkId="bext";break}(this.bext.timeReference[0]||this.bext.timeReference[1])&&(this.bext.chunkId="bext")},w.prototype.bb=function(){var t=[];if(this.iXML.chunkId){var i=x(this.iXML.value);this.iXML.chunkSize=i.length,t=t.concat(x(this.iXML.chunkId),o(this.iXML.chunkSize,this.a),i)}return this.l(t),t},w.prototype.Oa=function(){var t=[];return this.ds64.chunkId&&(t=t.concat(x(this.ds64.chunkId),o(this.ds64.chunkSize,this.a),o(this.ds64.riffSizeHigh,this.a),o(this.ds64.riffSizeLow,this.a),o(this.ds64.dataSizeHigh,this.a),o(this.ds64.dataSizeLow,this.a),o(this.ds64.originationTime,this.a),o(this.ds64.sampleCountHigh,this.a),o(this.ds64.sampleCountLow,this.a))),this.l(t),t},w.prototype.Ga=function(){var t=[];if(this.cue.chunkId){var i=this.Ja();t=t.concat(x(this.cue.chunkId),o(i.length+4,this.a),o(this.cue.dwCuePoints,this.a),i)}return this.l(t),t},w.prototype.Ja=function(){for(var t=[],i=0;i<this.cue.dwCuePoints;i++)t=t.concat(o(this.cue.points[i].dwName,this.a),o(this.cue.points[i].dwPosition,this.a),x(this.cue.points[i].fccChunk),o(this.cue.points[i].dwChunkStart,this.a),o(this.cue.points[i].dwBlockStart,this.a),o(this.cue.points[i].dwSampleOffset,this.a));return t},w.prototype.Ya=function(){var t=[];if(this.smpl.chunkId){var i=this.Za();t=t.concat(x(this.smpl.chunkId),o(i.length+36,this.a),o(this.smpl.dwManufacturer,this.a),o(this.smpl.dwProduct,this.a),o(this.smpl.dwSamplePeriod,this.a),o(this.smpl.dwMIDIUnityNote,this.a),o(this.smpl.dwMIDIPitchFraction,this.a),o(this.smpl.dwSMPTEFormat,this.a),o(this.smpl.dwSMPTEOffset,this.a),o(this.smpl.dwNumSampleLoops,this.a),o(this.smpl.dwSamplerData,this.a),i)}return this.l(t),t},w.prototype.Za=function(){for(var t=[],i=0;i<this.smpl.dwNumSampleLoops;i++)t=t.concat(o(this.smpl.loops[i].dwName,this.a),o(this.smpl.loops[i].dwType,this.a),o(this.smpl.loops[i].dwStart,this.a),o(this.smpl.loops[i].dwEnd,this.a),o(this.smpl.loops[i].dwFraction,this.a),o(this.smpl.loops[i].dwPlayCount,this.a));return t},w.prototype.Pa=function(){var t=[];return this.fact.chunkId&&(t=t.concat(x(this.fact.chunkId),o(this.fact.chunkSize,this.a),o(this.fact.dwSampleLength,this.a))),this.l(t),t},w.prototype.Qa=function(){var t=[];if(this.fmt.chunkId)return t=t.concat(x(this.fmt.chunkId),o(this.fmt.chunkSize,this.a),o(this.fmt.audioFormat,this.g),o(this.fmt.numChannels,this.g),o(this.fmt.sampleRate,this.a),o(this.fmt.byteRate,this.a),o(this.fmt.blockAlign,this.g),o(this.fmt.bitsPerSample,this.g),this.Ra()),this.l(t),t;throw Error('Could not find the "fmt " chunk')},w.prototype.Ra=function(){var t=[];return 16<this.fmt.chunkSize&&(t=t.concat(o(this.fmt.cbSize,this.g))),18<this.fmt.chunkSize&&(t=t.concat(o(this.fmt.validBitsPerSample,this.g))),20<this.fmt.chunkSize&&(t=t.concat(o(this.fmt.dwChannelMask,this.a))),24<this.fmt.chunkSize&&(t=t.concat(o(this.fmt.subformat[0],this.a),o(this.fmt.subformat[1],this.a),o(this.fmt.subformat[2],this.a),o(this.fmt.subformat[3],this.a))),t},w.prototype.Ta=function(){for(var t=[],i=0;i<this.LIST.length;i++){var e=this.Va(this.LIST[i].subChunks,this.LIST[i].format);t=t.concat(x(this.LIST[i].chunkId),o(e.length+4,this.a),x(this.LIST[i].format),e)}return this.l(t),t},w.prototype.Va=function(t,i){for(var e=[],s=0,n=t.length;s<n;s++)i=="INFO"?e=e.concat(this.Ua(t[s])):i=="adtl"&&(e=e.concat(this.Wa(t[s]))),this.l(e);return e},w.prototype.Ua=function(t){var i=[],e=A(t.value,t.value.length);return i=i.concat(x(t.chunkId),o(e.length+1,this.a),e),i.push(0),i},w.prototype.Wa=function(t){var i=[];if(-1<["labl","note"].indexOf(t.chunkId)){var e=A(t.value,t.value.length);i=i.concat(x(t.chunkId),o(e.length+5,this.a),o(t.dwName,this.a),e),i.push(0)}else t.chunkId=="ltxt"&&(i=i.concat(this.Xa(t)));return i},w.prototype.Xa=function(t){return x(t.chunkId).concat(o(t.value.length+20,this.a),o(t.dwName,this.a),o(t.dwSampleLength,this.a),o(t.dwPurposeID,this.a),o(t.dwCountry,this.g),o(t.dwLanguage,this.g),o(t.dwDialect,this.g),o(t.dwCodePage,this.g),A(t.value,t.value.length))},w.prototype.ab=function(){var t=[];if(this._PMX.chunkId){var i=x(this._PMX.value);this._PMX.chunkSize=i.length,t=t.concat(x(this._PMX.chunkId),o(this._PMX.chunkSize,this.a),i)}return this.l(t),t},w.prototype.Sa=function(){var t=[];return this.junk.chunkId?t.concat(x(this.junk.chunkId),o(this.junk.chunkData.length,this.a),this.junk.chunkData):(this.l(t),t)},w.prototype.l=function(t){t.length%2&&t.push(0)},k(I,w),I.prototype.fromScratch=function(t,i,e,s,n){n=n||{},this.U(),this.W(t,i,e,s,n)},I.prototype.fromBuffer=function(t,i){w.prototype.fromBuffer.call(this,t,i===void 0?!0:i),this.ya(),this.$()},I.prototype.toBuffer=function(){return this.aa(),w.prototype.toBuffer.call(this)},I.prototype.getSamples=function(t,i){t=t===void 0?!1:t,i=i===void 0?Float64Array:i;var e=new i(this.data.samples.length/(this.f.h/8));if(B(this.data.samples,this.f,e,0,this.data.samples.length),!t&&1<this.fmt.numChannels){var s=this.fmt.numChannels,n=i;n=n===void 0?Float64Array:n;for(var h=[],r=0;r<s;r++)h[r]=new n(e.length/s);for(n=0;n<s;n++){r=n;for(var a=0;r<e.length;r+=s,a++)h[n][a]=e[r]}e=h}return e},I.prototype.getSample=function(t){if(t*=this.f.h/8,t+this.f.h/8>this.data.samples.length)throw Error("Range error");return J(this.data.samples.slice(t,t+this.f.h/8),this.f)},I.prototype.setSample=function(t,i){if(t*=this.f.h/8,t+this.f.h/8>this.data.samples.length)throw Error("Range error");V([i],this.f,this.data.samples,t===void 0?0:t)},I.prototype.getiXML=function(){return this.iXML.value},I.prototype.setiXML=function(t){if(typeof t!="string")throw new TypeError("iXML value must be a string.");this.iXML.value=t,this.iXML.chunkId="iXML"},I.prototype.get_PMX=function(){return this._PMX.value},I.prototype.set_PMX=function(t){if(typeof t!="string")throw new TypeError("_PMX value must be a string.");this._PMX.value=t,this._PMX.chunkId="_PMX"},I.prototype.W=function(t,i,e,s,n){n.container||(n.container="RIFF"),this.container=n.container,this.bitDepth=e;var h=[];if(0<s.length)if(s[0].constructor!==Number){h=new Float64Array(s[0].length*s.length);for(var r=0,a=s[0].length,y=0;r<a;r++)for(var D=0,W=s.length;D<W;D++,y++)h[y]=s[D][r]}else h=s;s=h,this.$(),h=this.f.h/8,this.data.samples=new Uint8Array(s.length*h),V(s,this.f,this.data.samples,0),this.cb(e,t,i,h,this.data.samples.length,n),this.data.chunkId="data",this.data.chunkSize=this.data.samples.length,this.aa()},I.prototype.cb=function(t,i,e,s,n,h){t=="4"?this.za(t,i,e,s,n,h):t=="8a"||t=="8m"?this.Aa(t,i,e,s,n,h):Object.keys(this.G).indexOf(t)==-1||2<i?this.Ba(t,i,e,s,n,h):this.F(t,i,e,s,n,h)},I.prototype.F=function(t,i,e,s,n,h){this.container=h.container,this.chunkSize=36+n,this.format="WAVE",this.bitDepth=t,this.fmt={chunkId:"fmt ",chunkSize:16,audioFormat:this.G[t]||65534,numChannels:i,sampleRate:e,byteRate:i*s*e,blockAlign:i*s,bitsPerSample:parseInt(t,10),cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]}},I.prototype.za=function(t,i,e,s,n,h){this.F(t,i,e,s,n,h),this.chunkSize=40+n,this.fmt.chunkSize=20,this.fmt.byteRate=4055,this.fmt.blockAlign=256,this.fmt.bitsPerSample=4,this.fmt.cbSize=2,this.fmt.validBitsPerSample=505,this.fact={chunkId:"fact",chunkSize:4,dwSampleLength:2*n}},I.prototype.Ba=function(t,i,e,s,n,h){this.F(t,i,e,s,n,h),this.chunkSize=60+n,this.fmt.chunkSize=40,this.fmt.bitsPerSample=(parseInt(t,10)-1|7)+1,this.fmt.cbSize=22,this.fmt.validBitsPerSample=parseInt(t,10),t=this.fmt,e=0,i===1?e=4:i===2?e=3:i===4?e=51:i===6?e=63:i===8&&(e=1599),t.dwChannelMask=e,this.fmt.subformat=[1,1048576,2852126848,1905997824]},I.prototype.Aa=function(t,i,e,s,n,h){this.F(t,i,e,s,n,h),this.chunkSize=40+n,this.fmt.chunkSize=20,this.fmt.cbSize=2,this.fmt.validBitsPerSample=8,this.fact={chunkId:"fact",chunkSize:4,dwSampleLength:n}},I.prototype.ya=function(){this.fmt.audioFormat===3&&this.fmt.bitsPerSample===32?this.bitDepth="32f":this.fmt.audioFormat===6?this.bitDepth="8a":this.fmt.audioFormat===7?this.bitDepth="8m":this.bitDepth=this.fmt.bitsPerSample.toString()},I.prototype.wa=function(){if(!(this.G[this.bitDepth]||8<parseInt(this.bitDepth,10)&&54>parseInt(this.bitDepth,10)))throw Error("Invalid bit depth.")},I.prototype.$=function(){this.f={h:(parseInt(this.bitDepth,10)-1|7)+1,R:this.bitDepth=="32f"||this.bitDepth=="64",O:this.bitDepth!="8",o:this.container=="RIFX"},-1<["4","8a","8m"].indexOf(this.bitDepth)&&(this.f.h=8,this.f.O=!1)},I.prototype.aa=function(){this.wa();var t=this.fmt.numChannels;if(1>t||65535<t*this.fmt.bitsPerSample/8)throw Error("Invalid number of channels.");if(t=this.fmt.sampleRate,1>t||4294967295<this.fmt.bitsPerSample/8*this.fmt.numChannels*t)throw Error("Invalid sample rate.")},k(F,I),F.prototype.getTag=function(t){return t=this.P(t),t.w!==null?this.LIST[t.LIST].subChunks[t.w].value:null},F.prototype.setTag=function(t,i){var e=t;if(e.constructor!==String)throw Error("Invalid tag name.");if(4>e.length)for(var s=0,n=4-e.length;s<n;s++)e+=" ";t=e,e=this.P(t),e.w!==null?(this.LIST[e.LIST].subChunks[e.w].chunkSize=i.length+1,this.LIST[e.LIST].subChunks[e.w].value=i):e.LIST!==null?this.LIST[e.LIST].subChunks.push({chunkId:t,chunkSize:i.length+1,value:i}):(this.LIST.push({chunkId:"LIST",chunkSize:i.length+9,format:"INFO",subChunks:[]}),this.LIST[this.LIST.length-1].subChunks.push({chunkId:t,chunkSize:i.length+1,value:i}))},F.prototype.deleteTag=function(t){return t=this.P(t),t.w!==null?(this.LIST[t.LIST].subChunks.splice(t.w,1),!0):!1},F.prototype.listTags=function(){var t=this.C("INFO"),i={};if(t!==null)for(var e=0,s=this.LIST[t].subChunks.length;e<s;e++)i[this.LIST[t].subChunks[e].chunkId]=this.LIST[t].subChunks[e].value;return i},F.prototype.C=function(t){for(var i=0,e=this.LIST.length;i<e;i++)if(this.LIST[i].format==t)return i;return null},F.prototype.P=function(t){for(var i={LIST:null,w:null},e=0,s=this.LIST.length;e<s;e++)if(this.LIST[e].format=="INFO"){i.LIST=e,s=0;for(var n=this.LIST[e].subChunks.length;s<n;s++)if(this.LIST[e].subChunks[s].chunkId==t){i.w=s;break}break}return i},k(C,F),C.prototype.listCuePoints=function(){for(var t=this.J(),i=0,e=t.length;i<e;i++)t[i].position=t[i].dwSampleOffset/this.fmt.sampleRate*1e3,t[i].dwSampleLength?(t[i].end=t[i].dwSampleLength/this.fmt.sampleRate*1e3,t[i].end+=t[i].position):t[i].end=null,delete t[i].value;return t},C.prototype.setCuePoint=function(t){this.cue.chunkId="cue ",t.label||(t.label="");var i=this.J();this.I(),this.cue.points=[],t.dwSampleOffset=t.position*this.fmt.sampleRate/1e3,t.dwSampleLength=0,t.end&&(t.dwSampleLength=t.end*this.fmt.sampleRate/1e3-t.dwSampleOffset),i.length===0?this.B(t,1):this.ra(i,t),this.cue.dwCuePoints=this.cue.points.length},C.prototype.deleteCuePoint=function(t){this.cue.chunkId="cue ";var i=this.J();this.I();var e=this.cue.points.length;this.cue.points=[];for(var s=0;s<e;s++)s+1!==t&&this.B(i[s],s+1);this.cue.dwCuePoints=this.cue.points.length,this.cue.dwCuePoints?this.cue.chunkId="cue ":(this.cue.chunkId="",this.I())},C.prototype.updateLabel=function(t,i){var e=this.C("adtl");if(e!==null)for(var s=0,n=this.LIST[e].subChunks.length;s<n;s++)this.LIST[e].subChunks[s].dwName==t&&(this.LIST[e].subChunks[s].value=i)},C.prototype.J=function(){for(var t=[],i=0;i<this.cue.points.length;i++){var e=this.cue.points[i],s=this.Na(e.dwName);s.label=s.value?s.value:"",s.dwPosition=e.dwPosition,s.fccChunk=e.fccChunk,s.dwChunkStart=e.dwChunkStart,s.dwBlockStart=e.dwBlockStart,s.dwSampleOffset=e.dwSampleOffset,t.push(s)}return t},C.prototype.Na=function(t){var i=this.C("adtl"),e={};return i!==null&&this.ha(e,i,t),e},C.prototype.ha=function(t,i,e){for(var s=0,n=this.LIST[i].subChunks.length;s<n;s++)if(this.LIST[i].subChunks[s].dwName==e){var h=this.LIST[i].subChunks[s];t.value=h.value||t.value,t.dwName=h.dwName||0,t.dwSampleLength=h.dwSampleLength||0,t.dwPurposeID=h.dwPurposeID||0,t.dwCountry=h.dwCountry||0,t.dwLanguage=h.dwLanguage||0,t.dwDialect=h.dwDialect||0,t.dwCodePage=h.dwCodePage||0}},C.prototype.B=function(t,i){this.cue.points.push({dwName:i,dwPosition:t.dwPosition?t.dwPosition:0,fccChunk:t.fccChunk?t.fccChunk:"data",dwChunkStart:t.dwChunkStart?t.dwChunkStart:0,dwBlockStart:t.dwBlockStart?t.dwBlockStart:0,dwSampleOffset:t.dwSampleOffset}),this.ta(t,i)},C.prototype.ra=function(t,i){for(var e=!1,s=0;s<t.length;s++)t[s].dwSampleOffset>i.dwSampleOffset&&!e?(this.B(i,s+1),this.B(t[s],s+2),e=!0):this.B(t[s],e?s+2:s+1);e||this.B(i,this.cue.points.length+1)},C.prototype.I=function(){for(var t=0,i=this.LIST.length;t<i;t++)this.LIST[t].format=="adtl"&&this.LIST.splice(t)},C.prototype.ta=function(t,i){var e=this.C("adtl");e===null&&(this.LIST.push({chunkId:"LIST",chunkSize:4,format:"adtl",subChunks:[]}),e=this.LIST.length-1),this.sa(e,t,i),t.dwSampleLength&&this.ua(e,t,i)},C.prototype.sa=function(t,i,e){this.LIST[t].subChunks.push({chunkId:"labl",chunkSize:4,dwName:e,value:i.label}),this.LIST[t].chunkSize+=12},C.prototype.ua=function(t,i,e){this.LIST[t].subChunks.push({chunkId:"ltxt",chunkSize:20,dwName:e,dwSampleLength:i.dwSampleLength,dwPurposeID:i.dwPurposeID||0,dwCountry:i.dwCountry||0,dwLanguage:i.dwLanguage||0,dwDialect:i.dwDialect||0,dwCodePage:i.dwCodePage||0,value:i.label}),this.LIST[t].chunkSize+=28},M.prototype.H=function(t,i){return this.f(Math.round(this.l*t),i)},M.prototype.G=function(t,i){t*=this.l;var e=Math.floor(t);return t-=e,(1-t)*this.f(e,i)+t*this.f(e+1,i)},M.prototype.B=function(t,i){t*=this.l;var e=Math.floor(t),s=[this.m(e,i),this.m(e+1,i)],n=[this.f(e,i),this.f(e+1,i)];t-=e,e=t*t;var h=t*e;return(2*h-3*e+1)*n[0]+(h-2*e+t)*s[0]+(-2*h+3*e)*n[1]+(h-e)*s[1]},M.prototype.I=function(t,i){t*=this.l;var e=Math.floor(t),s=e+this.v,n=0;for(e=e-this.v+1;e<=s;e++)n+=this.F(t-e)*this.f(e,i);return n},M.prototype.m=function(t,i){return this.J*(this.f(t+1,i)-this.f(t-1,i))/2},M.prototype.f=function(t,i){return 0<=t&&t<this.C?i[t]:0},z.prototype.filter=function(t){this.z.L[this.z.N]=t;for(var i=t=0,e=this.z.L.length;i<e;i++)t+=this.a[i]*this.z.L[(this.z.N+i)%this.z.L.length];return this.z.N=(this.z.N+1)%this.z.L.length,t},z.prototype.reset=function(){this.z=this.b()},z.prototype.b=function(){for(var t=[],i=0;i<this.a.length-1;i++)t.push(0);return{L:t,N:0}},d.prototype.filter=function(t){for(var i=0,e=this.a.length;i<e;i++)t=this.f(i,t);return t},d.prototype.b=function(t){var i={D:[],A:[]};return t=this.c(t,i),i.k=1,i.A.push((1-t.ba)/(2*t.K)),i.A.push(2*i.A[0]),i.A.push(i.A[0]),i},d.prototype.c=function(t,i){var e={},s=2*Math.PI*t.oa/t.pa;return e.alpha=Math.sin(s)/(2*t.Q),e.ba=Math.cos(s),e.K=1+e.alpha,i.K=e.K,i.D.push(-2*e.ba/e.K),i.k=1,i.D.push((1-e.alpha)/e.K),e},d.prototype.f=function(t,i){var e=i*this.a[t].k-this.a[t].Ha*this.a[t].z[0]-this.a[t].Ia*this.a[t].z[1],s=this.a[t].Ka*e+this.a[t].La*this.a[t].z[0]+this.a[t].Ma*this.a[t].z[1];return this.a[t].z[1]=this.a[t].z[0],this.a[t].z[0]=e,s},d.prototype.reset=function(){for(var t=0;t<this.a.length;t++)this.a[t].z=[0,0]};var jt={point:!1,linear:!1,cubic:!0,sinc:!0},lt={IIR:16,FIR:71},Bt={IIR:d,FIR:z};k(l,C),l.prototype.toRIFF=function(){var t=new Float64Array(H(this.data.samples.length,this.f.h/8));B(this.data.samples,this.f,t,0,this.data.samples.length),this.m(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,t,{container:"RIFF"})},l.prototype.toRIFX=function(){var t=new Float64Array(H(this.data.samples.length,this.f.h/8));B(this.data.samples,this.f,t,0,this.data.samples.length),this.m(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,t,{container:"RIFX"})},l.prototype.toIMAADPCM=function(){if(this.fmt.sampleRate!==8e3)throw Error("Only 8000 Hz files can be compressed as IMA-ADPCM.");if(this.fmt.numChannels!==1)throw Error("Only mono files can be compressed as IMA-ADPCM.");this.H();var t=new Int16Array(H(this.data.samples.length,2));B(this.data.samples,this.f,t,0,this.data.samples.length),this.m(this.fmt.numChannels,this.fmt.sampleRate,"4",Pt(t),{container:this.v()})},l.prototype.fromIMAADPCM=function(t){t=t===void 0?"16":t,this.m(this.fmt.numChannels,this.fmt.sampleRate,"16",Ct(this.data.samples,this.fmt.blockAlign),{container:this.v()}),t!="16"&&this.toBitDepth(t)},l.prototype.toALaw=function(){this.H();var t=new Int16Array(H(this.data.samples.length,2));B(this.data.samples,this.f,t,0,this.data.samples.length),this.m(this.fmt.numChannels,this.fmt.sampleRate,"8a",zt(t),{container:this.v()})},l.prototype.fromALaw=function(t){t=t===void 0?"16":t,this.m(this.fmt.numChannels,this.fmt.sampleRate,"16",bt(this.data.samples),{container:this.v()}),t!="16"&&this.toBitDepth(t)},l.prototype.toMuLaw=function(){this.H();var t=new Int16Array(H(this.data.samples.length,2));B(this.data.samples,this.f,t,0,this.data.samples.length),this.m(this.fmt.numChannels,this.fmt.sampleRate,"8m",Dt(t),{container:this.v()})},l.prototype.fromMuLaw=function(t){t=t===void 0?"16":t,this.m(this.fmt.numChannels,this.fmt.sampleRate,"16",Tt(this.data.samples),{container:this.v()}),t!="16"&&this.toBitDepth(t)},l.prototype.toBitDepth=function(t,i){var e=t,s=this.bitDepth;i===void 0||i||(t!="32f"&&(e=this.f.h.toString()),s=""+this.f.h),this.T();var n=this.getSamples(!0),h=new Float64Array(n.length),r=s;if(-1<["32f","64"].indexOf(r)&&-1<["32f","64"].indexOf(e))h.set(n);else{it(r),it(e),s=Mt(r,e);var a={fa:Math.pow(2,parseInt(r,10))/2,da:Math.pow(2,parseInt(e,10))/2,ea:Math.pow(2,parseInt(r,10))/2-1,ca:Math.pow(2,parseInt(e,10))/2-1};et(r,n,!0),r=0;for(var y=n.length;r<y;r++)h[r]=s(n[r],a);et(e,h,!1)}this.m(this.fmt.numChannels,this.fmt.sampleRate,t,h,{container:this.v()})},l.prototype.toSampleRate=function(t,i){this.xa(t);var e=this.getSamples(),s=[];if(e.constructor===Float64Array)s=ot(e,this.fmt.sampleRate,t,i);else for(var n=0;n<e.length;n++)s.push(ot(e[n],this.fmt.sampleRate,t,i));this.m(this.fmt.numChannels,t,this.bitDepth,s,{container:this.v()})},l.prototype.xa=function(t){if(1>t||4294967295<this.fmt.bitsPerSample/8*this.fmt.numChannels*t)throw Error("Invalid sample rate.");if(-1<["4","8a","8m"].indexOf(this.bitDepth))throw Error("wavefile can't change the sample rate of compressed files.")},l.prototype.H=function(){this.T(),this.bitDepth!="16"&&this.toBitDepth("16")},l.prototype.T=function(){this.bitDepth=="8a"?this.fromALaw():this.bitDepth=="8m"?this.fromMuLaw():this.bitDepth=="4"&&this.fromIMAADPCM()},l.prototype.v=function(){return this.container=="RF64"?"RIFF":this.container},l.prototype.m=function(t,i,e,s,n){var h=new C;Object.assign(this.fmt,h.fmt),Object.assign(this.fact,h.fact),Object.assign(this.ds64,h.ds64),Object.assign(this.data,h.data),this.W(t,i,e,s,n)},k(u,l),u.prototype.fromBase64=function(t){this.fromBuffer(St(t))},u.prototype.toBase64=function(){for(var t=this.toBuffer(),i="",e=0;e<t.length;e+=3)i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[e]>>2],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t[e]&3)<<4|t[e+1]>>4],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t[e+1]&15)<<2|t[e+2]>>6],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[e+2]&63];return t.length%3===2?i=i.substring(0,i.length-1)+"=":t.length%3===1&&(i=i.substring(0,i.length-2)+"=="),i},u.prototype.toDataURI=function(){return"data:audio/wav;base64,"+this.toBase64()},u.prototype.fromDataURI=function(t){this.fromBase64(t.replace("data:audio/wav;base64,",""))},f.WaveFile=u,Object.defineProperty(f,"__esModule",{value:!0})}yt(p)})(tt,tt.exports);var _t=tt.exports;const Ht=()=>{let P=2,p=[];function m(c){let g=c.length,S=new Uint8Array(g*P);for(let T=0;T<g;T++){let k=T*P,b=c[T];b>1?b=1:b<-1&&(b=-1),b=b*32768,S[k]=b,S[k+1]=b>>8}p.push(S)}function v(c){let g=p.length?p[0].length:0,S=p.length*g,T=new Uint8Array(44+S),k=new DataView(T.buffer);k.setUint32(0,1380533830,!1),k.setUint32(4,36+S,!0),k.setUint32(8,1463899717,!1),k.setUint32(12,1718449184,!1),k.setUint32(16,16,!0),k.setUint16(20,1,!0),k.setUint16(22,1,!0),k.setUint32(24,c,!0),k.setUint32(28,c*P,!0),k.setUint16(32,P,!0),k.setUint16(34,8*P,!0),k.setUint32(36,1684108385,!1),k.setUint32(40,S,!0);for(let b=0;b<p.length;b++)T.set(p[b],b*g+44);p=[],postMessage(T.buffer,[T.buffer])}onmessage=c=>{c.data[0]==="encode"?m(c.data[1]):c.data[0]==="dump"&&v(c.data[1])}};let vt=window.AudioContext||window.webkitAudioContext,Wt=P=>{let p=P.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,""),m=new Blob([p]);return new Worker(URL.createObjectURL(m))},$=P=>{let p=new Event("error");return p.data=new Error("Wrong state for "+P),p},E;class j{constructor(p,m=null){this.stream=p,this.config=m,this.state="inactive",this.em=document.createDocumentFragment(),this.encoder=Wt(j.encoder);let v=this;this.encoder.addEventListener("message",c=>{let g=new Event("dataavailable");g.data=new Blob([c.data],{type:v.mimeType}),v.em.dispatchEvent(g),v.state==="inactive"&&v.em.dispatchEvent(new Event("stop"))})}start(p){if(this.state!=="inactive")return this.em.dispatchEvent($("start"));this.state="recording",E||(E=new vt(this.config)),this.clone=this.stream.clone(),this.input=E.createMediaStreamSource(this.clone),this.processor=E.createScriptProcessor(2048,1,1),this.analyser=E.createAnalyser(),this.analyser.fftSize=4096,this.myDataArray=new Float32Array(this.analyser.frequencyBinCount),this.encoder.postMessage(["init",E.sampleRate]),this.input.connect(this.analyser),this.analyser.connect(this.processor),this.processor.connect(E.destination),this.processor.onaudioprocess=m=>{this.state==="recording"&&this.encoder.postMessage(["encode",m.inputBuffer.getChannelData(0)]),this.analyser.getFloatFrequencyData(this.myDataArray),this.myDataArray.map((v,c)=>{}),m.inputBuffer.getChannelData(0).map(v=>{})},this.em.dispatchEvent(new Event("start")),p&&(this.slicing=setInterval(()=>{this.state==="recording"&&this.requestData()},p))}stop(){return this.state==="inactive"?this.em.dispatchEvent($("stop")):(this.requestData(),this.state="inactive",this.clone.getTracks().forEach(p=>{p.stop()}),this.processor.disconnect(),this.input.disconnect(),clearInterval(this.slicing))}pause(){return this.state!=="recording"?this.em.dispatchEvent($("pause")):(this.state="paused",this.em.dispatchEvent(new Event("pause")))}resume(){return this.state!=="paused"?this.em.dispatchEvent($("resume")):(this.state="recording",this.em.dispatchEvent(new Event("resume")))}requestData(){return this.state==="inactive"?this.em.dispatchEvent($("requestData")):this.encoder.postMessage(["dump",E.sampleRate])}addEventListener(...p){this.em.addEventListener(...p)}removeEventListener(...p){this.em.removeEventListener(...p)}dispatchEvent(...p){this.em.dispatchEvent(...p)}}j.prototype.mimeType="audio/wav";j.isTypeSupported=P=>j.prototype.mimeType===P;j.notSupported=!navigator.mediaDevices||!vt;j.encoder=Ht;class qt extends mt{Template(){return O` <div id="siri"></div> `}constructor(){const p={width:200,height:100};super(!0,p)}ComponentDidReceiedProps(p,m,v){console.log(p,m,v);const c=this.root.getElementById("siri");c.innerHTML="",this.siri=new ft({container:c,autostart:!0,width:this.props.width,height:this.props.height})}ComponentDidMount(){setTimeout(()=>{const p=this.root.getElementById("siri");this.siri=new ft({container:p,autostart:!0,width:this.props.width,height:this.props.height})},100)}Style(){return O`
      <style>
        #siri {
          width: ${this.props.width+"px"};
          height: ${this.props.height+"px"};
          background-size: cover;
          margin: 20px;
          margin: 0 auto;
          background-color: black;
          border: 1px dashed rgba(255, 255, 255, 0.4);
        }

        #siri canvas {
          float: left;
        }
      </style>
    `}}dt("fid-siri-wave",qt);class $t extends mt{constructor(){super(!1,{label:"NA",recognizefunc:null,token:"abcd"});q(this,"mediaRecorder",null);q(this,"audiofile",null);q(this,"download",this.root.querySelector("#download"));q(this,"siriWave",null);this.state={message:"ready",currentMessage:"type or record something",showPlay:!1,isRecording:!1}}stop(){this.mediaRecorder.stop(),this.setState({message:"recording stopped hit download",showPlay:!0,isRecording:!1})}textToSpeech(m){var v=new Headers;v.append("FID-LOG-TRACKING-ID","IAM_WAS_HERE"),v.append("VX-SB-APPID","AP139709"),v.append("BIT","16"),v.append("Authorization","Bearer "+this.props.token),v.append("Cookie","MC=9bKZDfxJ_sJq_DWfHxGe1VFUJEcSAmRj6PP5qnMpgeRo39viqjMGBAAAAQAGBWRj6PMAQ03");var c=new FormData;c.append("audiofile",m,"Audio1.wav");var g={method:"POST",headers:v,body:c,redirect:"follow"};this.setState({message:"parsing"}),fetch("https://simplibyt-xq1-aws.fmr.com/v1/simplibytes/stt/instant",g).then(S=>S.json()).then(S=>{console.log(S),this.setState({currentMessage:S.text,message:""})}).catch(S=>console.log("error",S))}start(){this.mediaRecorder.start(),this.audiofile=null,this.setState({showPlay:!1,message:"recording....",isRecording:!0})}play(){new Audio(this.audiofile).play()}send(){this.fireEvent("send","value",this.state.currentMessage),this.setState({currentMessage:"",showPlay:!0,isRecording:!1})}handleSuccess(m){this.mediaRecorder=new j(m);let v;this.mediaRecorder.addEventListener("dataavailable",async c=>{v=await c.data.arrayBuffer();const g=new _t.WaveFile(new Uint8Array(v));g.toRIFF(),g.toBitDepth(16),g.toSampleRate(16e3);const S=new Blob([g.toBuffer()],{type:"audio/wav"});this.audiofile=URL.createObjectURL(S),v=null,this.fireEvent("recored",this.audiofile),this.textToSpeech(S)}),this.mediaRecorder.addEventListener("stop",()=>{this.setState({showPlay:!0},()=>{console.log(this.state.showPlay),this.download=this.root.querySelector("#download"),this.download.download="acetest.wav",this.download.href=this.audiofile}),setTimeout(()=>{this.download=this.root.querySelector("#download"),this.download.download="acetest.wav",this.download.href=this.audiofile},1e3),v=null})}ComponentDidMount(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(m=>{this.setState({message:"Audio enabled..."}),this.handleSuccess(m)})}Template(){return O`
      <div class="speech">
        ${this.props.label} <br />

        ${this.state.isRecording?O`<siri-wave width="300px"></siri-wave>`:O`
              <textarea
                .value=${this.state.currentMessage}
                @change=${m=>{this.setState({...this.state,currentMessage:m.target.value})}}
                cols="60"
                rows="5"
              ></textarea>
            `}
        <br />
        ${this.state.showPlay?O`<a id="download">Download</a>`:null}

        <button @click=${()=>this.send()} id="send">send</button>
        ${this.state.isRecording?O`<button @click=${()=>this.stop()} id="stop">Stop</button>`:O`<button @click=${()=>this.start()} id="start">
              Start
            </button>`}
        ${this.state.showPlay?O`<button @click=${()=>this.play()}>Play</button>`:""}
        <br />
        ${this.state.message}
      </div>
    `}Style(){return O`<style>
      .speech {
        text-align:'left';
        border: 1px ${this.state.isRecording?"red":"black"}
          ${this.state.isRecording?"dashed":"solid"};
        padding: 10px;
        
      }

      siri-wave {
        width: 600px;
        height: 300px;
        background-size: cover;
        margin: 20px;
        margin: 0 auto;
        border: 1px dashed rgba(255, 255, 255, 0.4);
      }
    </style>`}}dt("fid-voice-chat",$t);
